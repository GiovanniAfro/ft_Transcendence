services:
    # backend:
    #     container_name: python-django
    #     build:
    #         context: ./requirements/nginx
    #         dockerfile: Dockerfile
    #     image: python:42
    #     restart: always
    #     ports:
    #         - "443:443"
    #     depends_on:
    #         - postgres
    #     # volumes:
    #     #     - wordpress_vol:/var/www/html
    #     networks:
    #         transcendence_net:
    #             ipv4_address: 10.0.0.1

    db:
        container_name: db-postgres
        env_file:
            - ./requirements/postgres/.env
        build:
            context: ./requirements/postgres
            dockerfile: Dockerfile
            # args:
            #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            #     POSTGRES_DB_NAME: ${POSTGRES_DB_NAME} 
            #     POSTGRES_DB_USER: ${POSTGRES_DB_USER}
            #     POSTGRES_DB_PASS: ${POSTGRES_DB_PASS}
        restart: always
        healthcheck:
            test: ["CMD-SHELL", "pg_isready"]
            interval: 1s
            timeout: 5s
            retries: 10
        volumes:
            - db_vol:/var/lib/postgresql/15/main
        networks:
            transcendence_net:
                ipv4_address: 10.0.0.1
    
    # postgres:
    #     container_name: postgres
    #     env_file:
    #         - .env
    #     build:
    #         context: ./requirements/postgres
    #         dockerfile: Dockerfile
    #         # args:
    #         #     MARIADB_DB_NAME: ${MARIADB_DB_NAME}
    #         #     MARIADB_DB_USER: ${MARIADB_DB_USER}
    #         #     MARIADB_DB_PASS: ${MARIADB_DB_PASS}
    #     image: postgres:42
    #     restart: always
    #     volumes:
    #         - postgresql_vol:/var/www/html
        # networks:
        #     transcendence_net:
        #         ipv4_address: 10.0.0.2

volumes:
  db_vol:
    driver: local
    name: db_vol
    driver_opts:
      type: none
      o: bind
      device: /data/db

networks:
    transcendence_net:
        name: transcendence_net
        driver: bridge
        ipam:
            driver: default
            config:
                - subnet: 10.0.0.0/24
                  gateway: 10.0.0.254
